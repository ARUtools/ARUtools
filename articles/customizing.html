<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Customizing `clean_metadata()` • ARUtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Customizing `clean_metadata()`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ARUtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ARUtools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/SubSample.html">Subsampling recordings</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/customizing.html">Customizing `clean_metadata()`</a></li>
    <li><a class="dropdown-item" href="../articles/spatial.html">Working with spatial data</a></li>
    <li><a class="dropdown-item" href="../articles/timezones.html">Dealing with Timezones</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/arutools/ARUtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Customizing `clean_metadata()`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/arutools/ARUtools/blob/HEAD/vignettes/customizing.Rmd" class="external-link"><code>vignettes/customizing.Rmd</code></a></small>
      <div class="d-none name"><code>customizing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://arutools.github.io/ARUtools/">ARUtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>In our “Getting started” tutorial, we worked with a set of files that
matched the expected metadata patterns. However, this is probably not
going to be the case much of the time.</p>
<p>Here we’ll go over how to customize ARUtools functions to work with
your data.</p>
<p>For example, let’s assume your files look like this, with two
recordings, one at Site 100-a45 May 4th 2020 at 5:25 am with ARU unit
S4A1234. The other at Site 102-b56 on the same day but at 5:40 am with
ARU unit S4A1111.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"site100-a45/2020_05_04_05_25_00_s4a1234.wav"</span>,</span>
<span>  <span class="st">"site102-b56/2020_05_04_05_40_00_s4a1111.wav"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If we try to clean this with the default arguments, we’re going to
have some problems.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No times were successfully detected (2/2)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No ARU ids were successfully detected (2/2)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No sites were successfully detected (2/2)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2020_05_04_0… wav   site… <span style="color: #BB0000;">NA</span>     Wildlife Ac… Song… SongMet… <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2020_05_04_0… wav   site… <span style="color: #BB0000;">NA</span>     Wildlife Ac… Song… SongMet… <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
<div class="section level2">
<h2 id="regular-expressions">Regular expressions<a class="anchor" aria-label="anchor" href="#regular-expressions"></a>
</h2>
<p>First let’s talk a bit about how <code><a href="../reference/clean_metadata.html">clean_metadata()</a></code>
extracts information.</p>
<p>This function uses <a href="https://stringr.tidyverse.org/articles/regular-expressions.html" class="external-link">regular
expressions</a> to match specific text patterns in the file path of each
recording. Regular expressions are really powerful, but also reasonably
complicated and can be confusing.</p>
<p>For example, by default, <code><a href="../reference/clean_metadata.html">clean_metadata()</a></code> matches site
ids with the expression ((Q)|(P))(())(_|-)(()).</p>
<p>Yikes!</p>
<p>Broken down, that means look for a “Q” <em>or</em> “P”
(<code>((Q)|(P))</code>) followed by two digits (<code>\\d{2}</code>)
followed by a separator, either <code>_</code> <em>or</em>
<code>-</code> (<code>_|-</code>) followed by a single digit
(<code>\\d{1}</code>).</p>
<p>This clearly doesn’t define the sites in our example here. You can
supply your own regular expression, instead.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">f</span>, pattern_site_id <span class="op">=</span> <span class="st">"site\\d{3}-(a|b)\\d{2}"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No times were successfully detected (2/2)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No ARU ids were successfully detected (2/2)</span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2020_05_04_0… wav   site… <span style="color: #BB0000;">NA</span>     Wildlife Ac… Song… SongMet… site10… <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2020_05_04_0… wav   site… <span style="color: #BB0000;">NA</span>     Wildlife Ac… Song… SongMet… site10… <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">site_id</span></span>
<span><span class="co">#&gt; [1] "site100-a45" "site102-b56"</span></span></code></pre></div>
<p>However, with sites that follow a reasonable pattern of a prefix,
followed by digits and optionally a suffix with digits, it might be
easier to use a helper function to create the regular expression for
you.</p>
<p>For example, to create a site id pattern we can use
<code><a href="../reference/create_pattern.html">create_pattern_site_id()</a></code>.</p>
<p>We specify the <code>prefix</code> text as well as how many digits we
might expect, a separator, <code>suffix</code> text and how many suffix
digits there might be.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat_site</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_site_id</a></span><span class="op">(</span></span>
<span>  prefix <span class="op">=</span> <span class="st">"site"</span>, p_digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, s_digits <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">pat_site</span></span>
<span><span class="co">#&gt; [1] "((site))((\\d{3}))(-)((b)|(a))((\\d{2}))"</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">f</span>, pattern_site_id <span class="op">=</span> <span class="va">pat_site</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No times were successfully detected (2/2)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No ARU ids were successfully detected (2/2)</span></span>
<span><span class="va">m</span><span class="op">$</span><span class="va">site_id</span></span>
<span><span class="co">#&gt; [1] "site100-a45" "site102-b56"</span></span></code></pre></div>
<p>It can be useful to look at the default patterns in the functions to
see what might be different in your data.</p>
<p>See <code><a href="../reference/create_pattern.html">?create_pattern_date</a></code> or any
<code>create_pattern</code> function to pull up the documentation and
explore the defaults as well as examples.</p>
<p>It can also be useful to test out a pattern before running all your
files.</p>
<p>We can use the <code><a href="../reference/create_pattern.html">test_pattern()</a></code> function to see if our
pattern successfully extracts the site id from the first file in our
list.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_pattern.html">test_pattern</a></span><span class="op">(</span><span class="va">f</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">pat_site</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "site100-a45"</span></span></code></pre></div>
<p>Let’s continue customizing our metadata patterns by specifying ARU
ids, dates and times.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pat_aru</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_aru_id</a></span><span class="op">(</span>arus <span class="op">=</span> <span class="st">"s4a"</span>, n_digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_site_id <span class="op">=</span> <span class="va">pat_site</span>,</span>
<span>  pattern_aru_id <span class="op">=</span> <span class="va">pat_aru</span>,</span>
<span>  pattern_dt_sep <span class="op">=</span> <span class="st">"_"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2020_05_04_0… wav   site… s4a12… Wildlife Ac… Song… SongMet… site10… <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2020_05_04_0… wav   site… s4a11… Wildlife Ac… Song… SongMet… site10… <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-options">Other options<a class="anchor" aria-label="anchor" href="#other-options"></a>
</h2>
<div class="section level3">
<h3 id="date-order">Date order<a class="anchor" aria-label="anchor" href="#date-order"></a>
</h3>
<p>Depending on your date formatting, you may also need to specify the
order of the year, month and day, in addition to changing the
pattern.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"P01-1/05042020_052500_S4A1234.wav"</span>,</span>
<span>  <span class="st">"P01-1/05042020_054000_S4A1111.wav"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_dt_sep <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>  pattern_date <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_date</a></span><span class="op">(</span>order <span class="op">=</span> <span class="st">"mdy"</span><span class="op">)</span>,</span>
<span>  order_date <span class="op">=</span> <span class="st">"mdy"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
<p>Note that you need to specify it once when making the pattern, and
then again when telling the function how to turn the extracted text into
a date.</p>
<p>You can specify more than one order with
<code>c("mdy", "ymd")</code>, but only do this if you <em>know</em> you
have multiple orders in the file names. In particular, try to avoid
using both <code>mdy</code> and <code>dmy</code>. Some of these dates
can be ambiguous (for example, what order is 05/05/2020?) and may not be
parsed correctly in these situations.</p>
</div>
<div class="section level3">
<h3 id="matching-multiple-patterns">Matching multiple patterns<a class="anchor" aria-label="anchor" href="#matching-multiple-patterns"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"P01-1/05042020_052500_S4A1234.wav"</span>,</span>
<span>  <span class="st">"P01-1/05042020_054000_S4A1111.wav"</span>,</span>
<span>  <span class="st">"Site10/2020-01-01T09:00:00_BARLT100.wav"</span>,</span>
<span>  <span class="st">"Site10/2020-01-02T09:00:00_BARLT100.wav"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Sometimes your files may use more than one pattern. You can address
this problem in one of two ways.</p>
<p><strong>One option is to run <code><a href="../reference/clean_metadata.html">clean_metadata()</a></code> twice and
then join the outputs</strong></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_dt_sep <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>  pattern_date <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_date</a></span><span class="op">(</span>order <span class="op">=</span> <span class="st">"mdy"</span><span class="op">)</span>,</span>
<span>  order_date <span class="op">=</span> <span class="st">"mdy"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Not all dates were successfully detected (2/4)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Not all times were successfully detected (2/4)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Not all ARU ids were successfully detected (2/4)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Not all sites were successfully detected (2/4)</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">m1</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span> <span class="co"># omit ones that didn't work</span></span>
<span><span class="va">m1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span>
<span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_site_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_site_id</a></span><span class="op">(</span>prefix <span class="op">=</span> <span class="st">"Site"</span>, s_digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  pattern_aru_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_aru_id</a></span><span class="op">(</span>n_digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Not all dates were successfully detected (1/4)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Not all times were successfully detected (2/4)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> Not all sites were successfully detected (2/4)</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">m2</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span> <span class="co"># omit ones that didn't work</span></span>
<span><span class="va">m2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2020-01-01T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2020-01-02T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2020-01-01T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2020-01-02T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
<p>With this approach you should check that the number of files in the
end matches the number you expect.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p><strong>Another option is to supply multiple patterns to
<code><a href="../reference/clean_metadata.html">clean_metadata()</a></code> or to the
<code>create_pattern_XXX()</code> functions</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_dt_sep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">"T"</span><span class="op">)</span>,</span>
<span>  pattern_date <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_date</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ymd"</span>, <span class="st">"mdy"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  order_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ymd"</span>, <span class="st">"mdy"</span><span class="op">)</span>,</span>
<span>  pattern_aru_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_aru_id</a></span><span class="op">(</span>n_digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  pattern_site_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_site_id</a></span><span class="op">(</span></span>
<span>    prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="st">"Site"</span><span class="op">)</span>,</span>
<span>    sep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>    s_digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 05042020_052… wav   P01-… S4A12… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 05042020_054… wav   P01-… S4A11… Wildlife Ac… Song… SongMet… P01-1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2020-01-01T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2020-01-02T0… wav   Site… BARLT… Frontier La… BAR-… BARLT    Site10  <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
<p><strong>Which approach you should use depends on the
situation.</strong></p>
<p>The first approach means that the patterns being matched are more
rigid. There is less of a chance of accidentally matching an incorrect
pattern. However, there is a chance of omitting files that don’t match
either pattern.</p>
<p>The second approach is more flexible in matching patterns and allows
you to do so all in one step, which is convenient. However, the more
flexible a pattern is, the more opportunities there are to get incorrect
matches and date parsing.</p>
<p>With both approaches, it is important to double check the results and
make sure the ids and date/times make sense.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_meta.html">check_meta</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">#&gt;   site_id aru_type  aru_id   type  n_files n_dirs n_days min_date           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> P01-1   SongMeter S4A1111  wav         1      1      1 2020-05-04 <span style="color: #949494;">05:40:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> P01-1   SongMeter S4A1234  wav         1      1      1 2020-05-04 <span style="color: #949494;">05:25:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Site10  BARLT     BARLT100 wav         2      1      2 2020-01-01 <span style="color: #949494;">09:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: max_date &lt;dttm&gt;, min_time &lt;time&gt;, max_time &lt;time&gt;</span></span></span>
<span><span class="fu"><a href="../reference/check_meta.html">check_meta</a></span><span class="op">(</span><span class="va">m</span>, date <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 10</span></span></span>
<span><span class="co">#&gt;   site_id aru_type  aru_id   type  date       n_files n_dirs n_days min_time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;time&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> P01-1   SongMeter S4A1111  wav   2020-05-04       1      1      1 05<span style="color: #949494;">:</span>40   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> P01-1   SongMeter S4A1234  wav   2020-05-04       1      1      1 05<span style="color: #949494;">:</span>25   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Site10  BARLT     BARLT100 wav   2020-01-01       1      1      1 09<span style="color: #949494;">:</span>00   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Site10  BARLT     BARLT100 wav   2020-01-02       1      1      1 09<span style="color: #949494;">:</span>00   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: max_time &lt;time&gt;</span></span></span>
<span><span class="fu"><a href="../reference/check_problems.html">check_problems</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 variables: path &lt;chr&gt;, aru_id &lt;chr&gt;, site_id &lt;chr&gt;, tz_offset &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">site_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "P01-1"  "Site10"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">aru_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "S4A1234"  "S4A1111"  "BARLT100"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="subsetting-files">Subsetting files<a class="anchor" aria-label="anchor" href="#subsetting-files"></a>
</h3>
<p>You may not want to extract meta data for every file in your list or
directory. Possibly this is because they’re not relevant recordings, or
because you have some formatting issues that make it easier to split
into separate groups first.</p>
<p>You can omit files using the <code>subset</code> and
<code>subset_type</code> arguments.</p>
<p>To keep only certain files, use the default
<code>subset_type = "keep"</code>. To omit certain files, use
<code>subset_type = "omit"</code>.</p>
<p>To keep only files with the “a” prefix (note that <code>^</code>
means ‘at the start’)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">example_files</span>, subset <span class="op">=</span> <span class="st">"^a"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 11</span></span></span>
<span><span class="co">#&gt;    file_name    type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> P01_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> P01_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P02_1_20200… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> P02_1_20200… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> P03_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P03_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> P04_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P04_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> P04_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P04_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> P05_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P05_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> P06_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P06_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> P07_1_20200… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P07_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> P07_1_20200… wav   a_S4… S4A01… Wildlife Ac… Song… SongMet… P07_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> P08_1_20200… wav   a_BA… BARLT… Frontier La… BAR-… BARLT    P08_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> P09_1_20200… wav   a_S4… S4A02… Wildlife Ac… Song… SongMet… P09_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> P10_1_20200… wav   a_S4… S4A03… Wildlife Ac… Song… SongMet… P10_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
<p>To omit all files with the “a” prefix</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">example_files</span>, subset <span class="op">=</span> <span class="st">"^a"</span>, subset_type <span class="op">=</span> <span class="st">"omit"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 28 × 11</span></span></span>
<span><span class="co">#&gt;    file_name    type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> P01_1_20200… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> P01_1_20200… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P02_1_20200… wav   j_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> P02_1_20200… wav   j_S4… S4A01… Wildlife Ac… Song… SongMet… P02_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> P03_1_20200… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P03_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> P04_1_20200… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P04_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> P04_1_20200… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P04_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> P05_1_20200… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P05_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> P06_1_20200… wav   j_BA… BARLT… Frontier La… BAR-… BARLT    P06_1   -0400    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> P07_1_20200… wav   j_S4… S4A01… Wildlife Ac… Song… SongMet… P07_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 18 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="matching-non-wave-files">Matching non-wave files<a class="anchor" aria-label="anchor" href="#matching-non-wave-files"></a>
</h3>
<p>By default <code><a href="../reference/clean_metadata.html">clean_metadata()</a></code> looks for .wav files. If you
want it to match something else, adjust the <code>file_type</code>
argument.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"a_BARLT10962_P01_1/P01_1_20200502T050000_ARU.mp4"</span>,</span>
<span>  <span class="st">"a_BARLT10962_P01_1/P01_1_20200503T052000_ARU.mp4"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Other wise we’ll run into problems…</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `clean_metadata()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Did not find any 'wav' files.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Use `file_type` to change file extension for sound files</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Check `project_dir`/`project_files` are correct</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">f</span>, file_type <span class="op">=</span> <span class="st">"mp4"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">#&gt;   file_name     type  path  aru_id manufacturer model aru_type site_id tz_offset</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> P01_1_202005… mp4   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> P01_1_202005… mp4   a_BA… BARLT… Frontier La… BAR-… BARLT    P01_1   <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: date_time &lt;dttm&gt;, date &lt;date&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="look-arounds">Look arounds<a class="anchor" aria-label="anchor" href="#look-arounds"></a>
</h3>
<p>In some cases identifying what lies before or after a string of
interest can help with extracting the pattern of interest. Details of
look arounds can be found on the <a href="https://stringr.tidyverse.org/articles/regular-expressions.html#look-arounds" class="external-link">“stringr”</a>
package website.</p>
<p>The following code shows a set of files that contain repeated
patterns that match both site and project folders. If we run
<code><a href="../reference/clean_metadata.html">clean_metadata()</a></code> it fails to detect dates and times.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"//BARLTs/DeploymentProjectXYZsites_202223/XYZBrantAirstrip/20230519_RemoteTrip2223/00015998_20230519T210900-0400_SS23.wav"</span>,</span>
<span>  <span class="st">"//BARLTs/DeploymentProjectXYZsites_202223/XYZPermafrostPFSC-SP1/20230415_RemoteTrip2223/00015321_20230415T214700-0400_Owls23.wav"</span>,</span>
<span>  <span class="st">"//BARLTs/DeploymentProjectXYZsites_202223/XYZfoxden30/20230623_RemoteTrip2223/00015370_20230623T062000-0400_SR23.wav"</span>,</span>
<span>  <span class="st">"//BARLTs/DeploymentProjectXYZsites_202223/XYZfoxden107/20220922_RemoteTrip2223/00016130_20220922T000200-0400_NFC22.wav"</span>,</span>
<span>  <span class="st">"//BARLTs/DeploymentProjectXYZsites_00202223/XYZfoxden107/20230711_RemoteTrip2223/00016130_20230711T093600-0400_SR23.wav"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_site_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_site_id</a></span><span class="op">(</span>prefix <span class="op">=</span> <span class="st">"XYZ\\w+"</span>, p_digits <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, sep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"-"</span><span class="op">)</span>, s_digits <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  pattern_aru_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_aru_id</a></span><span class="op">(</span>arus <span class="op">=</span> <span class="st">""</span>, n_digits <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No dates were successfully detected (5/5)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No times were successfully detected (5/5)</span></span></code></pre></div>
<p>Even worse, it returns the wrong <code>site_id</code> values.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">$</span><span class="va">site_id</span></span>
<span><span class="co">#&gt; [1] "XYZsites_202223"   "XYZsites_202223"   "XYZsites_202223"  </span></span>
<span><span class="co">#&gt; [4] "XYZsites_202223"   "XYZsites_00202223"</span></span></code></pre></div>
<p>To tackle the <code>site_id</code> issue we can add a look behind to
clue into the directory before the <code>site_id</code> always ends with
“202223/”.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_site_id_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_site_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_site_id</a></span><span class="op">(</span></span>
<span>    prefix <span class="op">=</span> <span class="st">"XYZ\\w+"</span>, p_digits <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, sep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"-"</span><span class="op">)</span>, s_digits <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span>
<span>    look_behind <span class="op">=</span> <span class="st">"202223/"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  pattern_aru_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_aru_id</a></span><span class="op">(</span>arus <span class="op">=</span> <span class="st">""</span>, n_digits <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Identified possible problems with metadata extraction:</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No dates were successfully detected (5/5)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> No times were successfully detected (5/5)</span></span>
<span></span>
<span><span class="va">m_site_id_fix</span><span class="op">$</span><span class="va">site_id</span></span>
<span><span class="co">#&gt; [1] "XYZBrantAirstrip"  "XYZPermafrostPFSC" "XYZfoxden30"      </span></span>
<span><span class="co">#&gt; [4] "XYZfoxden107"      "XYZfoxden107"</span></span></code></pre></div>
<p>This corrects the <code>site_id</code> values but the generic
“pattern_aru_id” means that the <code><a href="../reference/clean_metadata.html">clean_metadata()</a></code> fails to
detect dates and time as the “pattern_aru_id” is excluded when looking
for dates and times.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span></span>
<span>  project_files <span class="op">=</span> <span class="va">f</span>,</span>
<span>  pattern_site_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_site_id</a></span><span class="op">(</span></span>
<span>    prefix <span class="op">=</span> <span class="st">"XYZ\\w+"</span>, p_digits <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, sep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"-"</span><span class="op">)</span>, s_digits <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span>
<span>    look_behind <span class="op">=</span> <span class="st">"202223/"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  pattern_aru_id <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_aru_id</a></span><span class="op">(</span>arus <span class="op">=</span> <span class="st">""</span>, n_digits <span class="op">=</span> <span class="fl">8</span>, </span>
<span>                                         sep <span class="op">=</span> <span class="st">""</span>, </span>
<span>                                         look_behind <span class="op">=</span> <span class="st">"RemoteTrip2223/"</span>, </span>
<span>                                         look_ahead <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In the end the look arounds helped us pull out stubborn
<code>site_id</code> vaules and separate overlapping patterns of
<code>aru_id</code> and dates and times.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Hope, Steffi LaZerte, Government of Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

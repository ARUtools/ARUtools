<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Other useful functions • ARUtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Other useful functions">
<meta name="description" content="This article covers the aditional steps important in dealing with ARU recordings, however they often fall outside the standard workflow.
">
<meta property="og:description" content="This article covers the aditional steps important in dealing with ARU recordings, however they often fall outside the standard workflow.
">
<meta property="og:image" content="https://arutools.github.io/ARUtools/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ARUtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ARUtools.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/SubSample.html">Subsampling recordings</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Customization</h6></li>
    <li><a class="dropdown-item" href="../articles/customizing.html">Customizing `clean_metadata()`</a></li>
    <li><a class="dropdown-item" href="../articles/spatial.html">Working with spatial data</a></li>
    <li><a class="dropdown-item" href="../articles/timezones.html">Dealing with Timezones</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/arutools/ARUtools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Other useful functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/arutools/ARUtools/blob/HEAD/vignettes/Misc.Rmd" class="external-link"><code>vignettes/Misc.Rmd</code></a></small>
      <div class="d-none name"><code>Misc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setting-up-your-folder-structure">Setting up your folder structure<a class="anchor" aria-label="anchor" href="#setting-up-your-folder-structure"></a>
</h2>
<p>While most of <code>ARUtools</code> focuses on processing recordings
once they are transferred from ARUs, setting up a folder structure can
greatly increase efficiency in transferring files.</p>
<p>To set up a folder structure you will need the hierarchical structure
you wish to use and the list of sites/arus you are processing.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site_list</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">example_sites</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">Sites</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plot"</span>, <span class="st">"site"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span>, remove <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>site_id <span class="op">=</span> <span class="va">Sites</span>, <span class="va">plot</span>, <span class="va">site</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span>check <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/ARUtools/"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tmp_dir</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_directory_structure</span><span class="op">(</span></span>
<span>  hexagons <span class="op">=</span> <span class="va">site_list</span><span class="op">$</span><span class="va">plot</span>,</span>
<span>  units <span class="op">=</span> <span class="va">site_list</span><span class="op">$</span><span class="va">site_id</span>,</span>
<span>  base_dir <span class="op">=</span> <span class="va">tmp_dir</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This should create a series of folders with plot at the main level
and site in the subdirectory below that.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.dirs</a></span><span class="op">(</span><span class="va">tmp_dir</span>, full.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>Note that this will not work for all project structures and you
should think carefully about how you want to set up your file names,
folder structure and spatial information before you deploy any ARUs.</p>
</div>
<div class="section level2">
<h2 id="wind-processing">Wind processing<a class="anchor" aria-label="anchor" href="#wind-processing"></a>
</h2>
<p>One issue that can cause difficulty in interpretation of acoustic
recordings is wind. Wind can mask bird songs and even is a potential
danger to interpreters’ ears.</p>
<p>The University Of Salford Acoustics Research Centre developed a
softare program <a href="https://github.com/kenders2000/WindNoiseDetection?tab=readme-ov-file#university-of-salford-acoustics-research-centre" class="external-link">WindNoiseDetection</a>
that detects wind in wave files.</p>
<p>I have developed a <a href="https://github.com/dhope/WindNoiseDetection" class="external-link">fork of the
software</a> that has added the ability to run multiple files at once
using parallel processing and to provide a list of files to process.</p>
<p>Running the program requires fairly complex setup in Windows as is
uses <code>C</code> and <code>C++</code> and requires
<code>Cygwin</code> to run.</p>
<p>However if you do get it running, <code>ARUtools</code> includes a
couple helper functions to process your metadata and set it up for
running with WindNoiseDetection.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind_files</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/wind_detection_pre_processing.html">wind_detection_pre_processing</a></span><span class="op">(</span></span>
<span>    wav_files <span class="op">=</span> <span class="va">example_clean</span><span class="op">$</span><span class="va">path</span>,</span>
<span>    output_directory <span class="op">=</span> <span class="st">"./wind_files/"</span>,</span>
<span>    site_pattern <span class="op">=</span> <span class="fu"><a href="../reference/create_pattern.html">create_pattern_site_id</a></span><span class="op">(</span></span>
<span>      p_digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>      s_digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    write_to_file <span class="op">=</span> <span class="cn">F</span>, chunk_size <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The output is a list of vectors that include the path to the wave
files (<code>filePaths</code>), the input wave filenames
(<code>filenames</code>), and the list of sites to append to the output
results (<code>sites</code>).</p>
<p>Once you have run <code>WindNoiseDetection</code> you can read the
results in using <code><a href="../reference/wind_detection_summarize_json.html">wind_detection_summarize_json()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_json</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"P71-1__20210606T232500-0400_SS.json"</span>, package <span class="op">=</span> <span class="st">"ARUtools"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wind_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wind_detection_summarize_json.html">wind_detection_summarize_json</a></span><span class="op">(</span><span class="va">example_json</span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">wind_summary</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ totalwindless <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 268.58</span></span>
<span><span class="co">#&gt; $ pwindless     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.8966715</span></span>
<span><span class="co">#&gt; $ n             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 5</span></span>
<span><span class="co">#&gt; $ length        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 299.53</span></span>
<span><span class="co">#&gt; $ mean_windless <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 53.716</span></span>
<span><span class="co">#&gt; $ path          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "/cygdrive/P/Path/To/WaveFile/NL/P71/P71-1/20210606_Napk…</span></span>
<span><span class="co">#&gt; $ jsonF         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "P71-1__20210606T232500-0400_SS.json"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assign-tasks">Assign tasks<a class="anchor" aria-label="anchor" href="#assign-tasks"></a>
</h2>
<p>To assign tasks you will need to either download the task template
from ‘WildTrax’ or alternatively you can use the new
<code>wildRtrax::wt_make_aru_tasks()</code> function.</p>
<p>You will also need a template for observers with the number of hours
they will be interpreting. This doesn’t have to match exactly the time
in a project as the relative amounts are used.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in_tasks</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">file_temp</a></span><span class="op">(</span><span class="st">"Input_task_file"</span>, ext <span class="op">=</span> <span class="st">".csv"</span><span class="op">)</span></span>
<span><span class="va">task_template</span> <span class="op">&lt;-</span> <span class="fu">wildRtrax</span><span class="fu">::</span><span class="fu">wt_make_aru_tasks</span><span class="op">(</span></span>
<span>  <span class="va">example_clean</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      recording_date_time <span class="op">=</span> <span class="va">date_time</span>,</span>
<span>      file_path <span class="op">=</span> <span class="va">path</span>, location <span class="op">=</span> <span class="va">site_id</span>,</span>
<span>      length_seconds <span class="op">=</span> <span class="fl">300</span></span>
<span>    <span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="va">in_tasks</span>,</span>
<span>  task_method <span class="op">=</span> <span class="st">"1SPT"</span>, task_length <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">template_observers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   transcriber                     hrs</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Charles Dickens                 5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> John Von Jovie                  1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> John Yossarian                  6.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Rodion Romanovich Raskolnikov   2.3</span></span></code></pre></div>
<p>Once you have the files you need, you can run
<code><a href="../reference/wt_assign_tasks.html">wt_assign_tasks()</a></code> to randomly assign tasks to interpreters
based on the amount of effort they can put in.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wt_assign_tasks.html">wt_assign_tasks</a></span><span class="op">(</span></span>
<span>  wt_task_template_in <span class="op">=</span> <span class="va">task_template</span>,</span>
<span>  wt_task_output_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  interp_hours <span class="op">=</span> <span class="va">template_observers</span>,</span>
<span>  interp_hours_column <span class="op">=</span> <span class="va">hrs</span>,</span>
<span>  random_seed <span class="op">=</span> <span class="fl">65416</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_output</span><span class="op">$</span><span class="va">task_summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   transcriber                   hrs_assigned   hrs   phrs updated_hrs_remain</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> John Yossarian                       1.08    6.5 0.439               5.42 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Rodion Romanovich Raskolnikov        1.08    2.3 0.155               1.22 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Charles Dickens                      1.17    5   0.338               3.83 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> John Von Jovie                       0.167   1   0.067<span style="text-decoration: underline;">6</span>              0.833</span></span></code></pre></div>
<p>You can alternatively use the <code>Shiny</code> app <a href="https://github.com/dhope/Shiny_select" class="external-link">Shiny_select</a> by running
the following:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shiny</span><span class="fu">::</span><span class="fu">runGitHub</span><span class="op">(</span><span class="st">"dhope/Shiny_select"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Hope, Steffi LaZerte, Government of Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

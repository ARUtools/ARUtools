<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="This article covers the workflow to randomly sample recordings.
">
<title>Subsampling recordings • ARUtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Subsampling recordings">
<meta property="og:description" content="This article covers the workflow to randomly sample recordings.
">
<meta property="og:image" content="http://arutools.github.io/ARUtools/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ARUtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.5.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ARUtools.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/SubSample.html">Subsampling recordings</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Customization</h6>
    <a class="dropdown-item" href="../articles/customizing.html">Customizing `clean_metadata()`</a>
    <a class="dropdown-item" href="../articles/spatial.html">Working with spatial data</a>
    <a class="dropdown-item" href="../articles/timezones.html">Dealing with Timezones</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/dhope/ARUtools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Subsampling recordings</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dhope/ARUtools/blob/HEAD/vignettes/SubSample.Rmd" class="external-link"><code>vignettes/SubSample.Rmd</code></a></small>
      <div class="d-none name"><code>SubSample.Rmd</code></div>
    </div>

    
    
<p>This vignette will walk through the workflow of subsampling
recordings. This can be particularily useful if you have many more
recordings than you can interpret manually.</p>
<div class="section level3">
<h3 id="create-data">Create data<a class="anchor" aria-label="anchor" href="#create-data"></a>
</h3>
<p>We will generate some data from the sites in
<code>example_sites</code>. Click on the triangle below to see the
details of this method.</p>
<!-- https://github.com/mrworthington/mrworthington.github.io/blob/master/articles/public_health/covid_atx/covid_atx_analysis.qmd -->
<details><summary><strong>Details of simulation </strong>
</summary><p>To simulate the file names we generate a series of recordings at each
site. Here the schedule is every 30 minutes between 5:30 and 8:00 AM
every second day between 1 May and 10 July.</p>
<p>Normally you would want to schedule based around local sunrise if
targeting the dawn chorus, but this will work for our purposes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span>
<span></span>
<span><span class="va">simple_deploy</span> <span class="op">&lt;-</span> </span>
<span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>site_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">example_sites</span><span class="op">$</span><span class="va">Sites</span><span class="op">)</span>,</span>
<span>                   </span>
<span>                   doy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">121</span>,<span class="fl">191</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">120</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">site_id</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"plot"</span>, <span class="st">"site"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span>, remove <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">example_sites</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">site_id</span> <span class="op">==</span> <span class="va">Sites</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># aru_id = glue::glue("BARLT-000{as.numeric(as.factor(site_id))}"),</span></span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2028-01-01"</span><span class="op">)</span><span class="op">+</span><span class="va">doy</span>,</span>
<span>         date_time <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{date} 06:00"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">minutes</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>,</span>
<span>         date_time_chr <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span>, <span class="st">"\\s"</span>, <span class="st">"T"</span><span class="op">)</span>,</span>
<span>         file_name <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{plot}/{site_id}/{ARU}_{date_time_chr}.wav"</span><span class="op">)</span> <span class="op">)</span></span>
<span>  </span>
<span><span class="va">simple_deploy</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,160 × 16</span></span></span>
<span><span class="co">#&gt;   site_id plot  site    doy times Date_set_out Date_removed ARU        lon   lat</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> P01_1   P01   1       121   -<span style="color: #BB0000;">30</span> 2020-05-01   2020-05-03   BARLT10… -<span style="color: #BB0000;">85.0</span>  50.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> P01_1   P01   1       121     0 2020-05-01   2020-05-03   BARLT10… -<span style="color: #BB0000;">85.0</span>  50.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> P01_1   P01   1       121    30 2020-05-01   2020-05-03   BARLT10… -<span style="color: #BB0000;">85.0</span>  50.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> P01_1   P01   1       121    60 2020-05-01   2020-05-03   BARLT10… -<span style="color: #BB0000;">85.0</span>  50.0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,156 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: Plots &lt;chr&gt;, Subplot &lt;chr&gt;, date &lt;date&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   date_time &lt;dttm&gt;, date_time_chr &lt;chr&gt;, file_name &lt;glue&gt;</span></span></span></code></pre></div>
<p>Our site info will be that used in <code>example_sites</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site_info</span> <span class="op">&lt;-</span> <span class="va">simple_deploy</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_min</a></span><span class="op">(</span>order_by <span class="op">=</span> <span class="va">date_time</span>, n<span class="op">=</span><span class="fl">1</span>, by <span class="op">=</span> <span class="va">site_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">site_id</span>, <span class="va">ARU</span>, <span class="va">lon</span>, <span class="va">lat</span>, <span class="va">date_time</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="clean-metadata">Clean metadata<a class="anchor" aria-label="anchor" href="#clean-metadata"></a>
</h3>
<p>To clean the metadata we can use the same code found in the <a href="https://arutools.github.io/ARUtools/articles/ARUtools.html" class="external-link">Getting
Started</a> vignette. I have used a pipe to save space here, but you can
see the details in the linked article
(<code><a href="../articles/ARUtools.html">vignette("ARUtools")</a></code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_site_index.html">clean_site_index</a></span><span class="op">(</span><span class="va">site_info</span>,</span>
<span>                          col_aru_id <span class="op">=</span> <span class="st">"ARU"</span>, </span>
<span>                          col_site_id <span class="op">=</span> <span class="st">"site_id"</span>, </span>
<span>                          col_date_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date_time"</span><span class="op">)</span>,</span>
<span>                          col_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_metadata.html">clean_metadata</a></span><span class="op">(</span>project_files <span class="op">=</span> <span class="va">simple_deploy</span><span class="op">$</span><span class="va">file_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_sites.html">add_sites</a></span><span class="op">(</span> <span class="va">sites</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/calc_sun.html">calc_sun</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> doy <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">yday</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting ARU info...</span></span>
<span><span class="co">#&gt; Extracting Dates and Times...</span></span>
<span><span class="co">#&gt; Joining by column `date_time` using buffers</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2,160</span></span>
<span><span class="co">#&gt; Columns: 14</span></span>
<span><span class="co">#&gt; $ file_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BARLT10962_2028-05-01T05:30:00.wav", "BARLT10962_2028-05-01…</span></span>
<span><span class="co">#&gt; $ type      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "wav", "wav", "wav", "wav", "wav", "wav", "wav", "wav", "wav…</span></span>
<span><span class="co">#&gt; $ path      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "P01/P01_1/BARLT10962_2028-05-01T05:30:00.wav", "P01/P01_1/B…</span></span>
<span><span class="co">#&gt; $ aru_type  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BarLT", "BarLT", "BarLT", "BarLT", "BarLT", "BarLT", "BarLT…</span></span>
<span><span class="co">#&gt; $ aru_id    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BARLT10962", "BARLT10962", "BARLT10962", "BARLT10962", "BAR…</span></span>
<span><span class="co">#&gt; $ site_id   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "P01_1", "P01_1", "P01_1", "P01_1", "P01_1", "P01_1", "P01_1…</span></span>
<span><span class="co">#&gt; $ date_time <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2028-05-01 05:30:00, 2028-05-01 06:00:00, 2028-05-01 06:30:…</span></span>
<span><span class="co">#&gt; $ date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2028-05-01, 2028-05-01, 2028-05-01, 2028-05-01, 2028-05-01,…</span></span>
<span><span class="co">#&gt; $ longitude <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -85.03, -85.03, -85.03, -85.03, -85.03, -85.03, -85.03, -85.…</span></span>
<span><span class="co">#&gt; $ latitude  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 50.01, 50.01, 50.01, 50.01, 50.01, 50.01, 50.01, 50.01, 50.0…</span></span>
<span><span class="co">#&gt; $ tz        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "America/Toronto", "America/Toronto", "America/Toronto", "Am…</span></span>
<span><span class="co">#&gt; $ t2sr      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -46.80, -16.80, 13.20, 43.20, 73.20, 103.20, -43.35, -13.35,…</span></span>
<span><span class="co">#&gt; $ t2ss      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 511.6167, 541.6167, 571.6167, 601.6167, 631.6167, 661.6167, …</span></span>
<span><span class="co">#&gt; $ doy       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 122, 122, 122, 122, 122, 122, 124, 124, 124, 124, 124, 124, …</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<p>Generally for random sampling you may not want to have recordings
selected with equal weight across time and dates. For example if you are
sampling songbirds in the breeding season, most species will be most
active for a couple hours from around sunrise. You will also want to
limit the dates to ensure you are picking up breeding birds and not
migrants.</p>
<p>To deal with this issue we allow the user to specify selection
weights based on the time to sunrise (or sunset) as well as the day of
year.</p>
<p><strong>Note:</strong> This is an active area of development and you
can expect the process of assigning variables to be much simpler in the
next update.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>min_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">70</span>, <span class="fl">240</span><span class="op">)</span>,</span>
<span>                          doy_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">yday</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-07-20"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          mean_min <span class="op">=</span> <span class="fl">30</span>, sd_min <span class="op">=</span> <span class="fl">60</span>,</span>
<span>                          mean_doy <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">yday</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-06-10"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          sd_doy <span class="op">=</span> <span class="fl">20</span>,off<span class="op">=</span><span class="fl">0</span>,</span>
<span>                          log_ <span class="op">=</span> <span class="cn">TRUE</span>, fun <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span> </span></code></pre></div>
<p>To visualize the selection parameters use
<code>gen_dens_sel_simulation</code>. This will show you how the sample
weights will change over time and time to sunrise/sunset.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gen_dens_sel_simulation.html">gen_dens_sel_simulation</a></span><span class="op">(</span>parms <span class="op">=</span> <span class="va">params</span><span class="op">)</span> </span></code></pre></div>
<p><img src="SubSample_files/figure-html/unnamed-chunk-6-1.png" width="700" height="8"></p>
</div>
<div class="section level3">
<h3 id="calculate-selection-weights">Calculate selection weights<a class="anchor" aria-label="anchor" href="#calculate-selection-weights"></a>
</h3>
<p>Once you have your parameters set up, you can use them to calculate
the sampling weights from the metadata.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full_selection_probs</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">metadata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/calc_sel_pr.html">calc_sel_pr</a></span><span class="op">(</span></span>
<span>    ARU_ID_col <span class="op">=</span> <span class="va">site_id</span>, </span>
<span>    min_col <span class="op">=</span> <span class="va">t2sr</span>, </span>
<span>    day_col <span class="op">=</span> <span class="va">doy</span>,</span>
<span>    parms <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>Below you can see the selection weights <code>psel_normalized</code>.
The highest selection weights should match the output from
<code><a href="../reference/gen_dens_sel_simulation.html">gen_dens_sel_simulation()</a></code>. Not that as our schedule is set
to start based on time, the time to sunrise that the recordings occur
differ by sites.</p>
<p><img src="SubSample_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="assign-sample-size">Assign sample size<a class="anchor" aria-label="anchor" href="#assign-sample-size"></a>
</h3>
<p>The next step is to assign sample sizes. This can be done on a per
site basis or across the board. Here I use a 2% sampling rate, but your
own subsampling intensity will depend on project goals. You can also set
an oversample to draw extra samples in case some samples are unusable
(e.g. due to wind).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">full_selection_probs</span>,  <span class="va">site_id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span><span class="va">site_id</span>,</span>
<span>            N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">.02</span><span class="op">)</span>,</span>
<span>         n_os  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="fl">.3</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span></code></pre></div>
<p>The figure below can provide a coarse rule of thumb on how many
minutes of recordings you might need or number of samples. It of course
has many assumptions including knowledge of probability of observing per
minute, that this probability will change by date, time of day,
conspecific behaviour, weather, etc.</p>
<p><img src="SubSample_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="draw-subsample">Draw subsample<a class="anchor" aria-label="anchor" href="#draw-subsample"></a>
</h3>
<div class="section level4">
<h4 id="grts">GRTS<a class="anchor" aria-label="anchor" href="#grts"></a>
</h4>
<p>There are a few ways to subsample recordings. <code>ARUtools</code>
has imported the <a href="https://usepa.github.io/spsurvey/articles/sampling.html" class="external-link">grts()</a>
(Generalized Random Tessellation Stratified algorithm) function from <a href="https://usepa.github.io/spsurvey/" class="external-link">spsurvey</a> package. We
developed a wrapper around the function to simplify it’s usage for our
particular use case.</p>
<p>GRTS allows us to sample using a dispersed samples, while maintaining
a stochastic element to sampling. In our case we are selecting samples
dispersed across dates and time in the dates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grts_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fun_aru_samp.html">fun_aru_samp</a></span><span class="op">(</span><span class="va">full_selection_probs</span>, </span>
<span>                         N <span class="op">=</span> <span class="va">sample_size</span>,</span>
<span>                         strat_ <span class="op">=</span> <span class="st">"site_id"</span>,</span>
<span>                         seed <span class="op">=</span> <span class="fl">2024</span>, </span>
<span>                         selprob_id <span class="op">=</span> <span class="st">"psel_normalized"</span>,</span>
<span>                         x <span class="op">=</span> <span class="st">'doy'</span>,y <span class="op">=</span> <span class="st">'t2sr'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Since version 0.4 default selection parameter in gen_dens_sel_simulation is psel_normalize,</span></span>
<span><span class="co">#&gt;          which ranges from 0 to 1. If you wish to base decisions here off the simulation,</span></span>
<span><span class="co">#&gt;          you can adjust the `selection_variable` paramter, which is an unquoted variable name of which</span></span>
<span><span class="co">#&gt;          options are psel, psel_doy, psel_tod, psel_std, psel_scaled, or psel_normalized</span></span>
<span><span class="co">#&gt; [1] "10"     "Sample"</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">grts_res</span><span class="op">$</span><span class="va">sites_base</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 40</span></span>
<span><span class="co">#&gt; Columns: 29</span></span>
<span><span class="co">#&gt; $ siteID          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Sample-01", "Sample-02", "Sample-03", "Sample-04", "S…</span></span>
<span><span class="co">#&gt; $ siteuse         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Base", "Base", "Base", "Base", "Base", "Base", "Base"…</span></span>
<span><span class="co">#&gt; $ replsite        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "None", "None", "None", "None", "None", "None", "None"…</span></span>
<span><span class="co">#&gt; $ lon_WGS84       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.001365439, 0.001545102, 0.001203742, 0.001563069, 0.…</span></span>
<span><span class="co">#&gt; $ lat_WGS84       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4.723823e-04, 5.254387e-04, -2.502089e-04, -2.125268e-…</span></span>
<span><span class="co">#&gt; $ stratum         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "P01_1", "P01_1", "P01_1", "P01_1", "P02_1", "P02_1", …</span></span>
<span><span class="co">#&gt; $ wgt             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 35.29300, 36.72486, 72.07435, 38.37921, 33.54426, 76.4…</span></span>
<span><span class="co">#&gt; $ ip              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.028334233, 0.027229512, 0.013874562, 0.026055777, 0.…</span></span>
<span><span class="co">#&gt; $ caty            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "None", "None", "None", "None", "None", "None", "None"…</span></span>
<span><span class="co">#&gt; $ aux             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9307375, 0.8944490, 0.4557587, 0.8558936, 0.9678483,…</span></span>
<span><span class="co">#&gt; $ file_name       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BARLT10962_2028-05-31T06:30:00.wav", "BARLT10962_2028…</span></span>
<span><span class="co">#&gt; $ type            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "wav", "wav", "wav", "wav", "wav", "wav", "wav", "wav"…</span></span>
<span><span class="co">#&gt; $ path            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "P01/P01_1/BARLT10962_2028-05-31T06:30:00.wav", "P01/P…</span></span>
<span><span class="co">#&gt; $ aru_type        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BarLT", "BarLT", "BarLT", "BarLT", "SongMeter", "Song…</span></span>
<span><span class="co">#&gt; $ aru_id          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "BARLT10962", "BARLT10962", "BARLT10962", "BARLT10962"…</span></span>
<span><span class="co">#&gt; $ site_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "P01_1", "P01_1", "P01_1", "P01_1", "P02_1", "P02_1", …</span></span>
<span><span class="co">#&gt; $ date_time       <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2028-05-31 06:30:00, 2028-06-20 06:30:00, 2028-05-13 …</span></span>
<span><span class="co">#&gt; $ date            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2028-05-31, 2028-06-20, 2028-05-13, 2028-06-22, 2028-…</span></span>
<span><span class="co">#&gt; $ longitude       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -85.03, -85.03, -85.03, -85.03, -87.45, -87.45, -87.45…</span></span>
<span><span class="co">#&gt; $ latitude        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 50.01, 50.01, 50.01, 50.01, 52.68, 52.68, 52.68, 52.68…</span></span>
<span><span class="co">#&gt; $ tz              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "America/Toronto", "America/Toronto", "America/Toronto…</span></span>
<span><span class="co">#&gt; $ t2ss            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 530.1500, 516.0667, 493.4667, 455.6000, 438.7000, 551.…</span></span>
<span><span class="co">#&gt; $ psel_tod        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.4561300, -0.4598709, -0.4920422, -0.4628636, -0.460…</span></span>
<span><span class="co">#&gt; $ psel_doy        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.6675488, -0.6758601, -0.8021915, -0.6858336, -0.650…</span></span>
<span><span class="co">#&gt; $ psel            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.3250817, 0.3211873, 0.2741078, 0.3170496, 0.3290624,…</span></span>
<span><span class="co">#&gt; $ psel_scaled     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9775970, 0.9658855, 0.8243066, 0.9534425, 0.9895679,…</span></span>
<span><span class="co">#&gt; $ psel_std        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9776457, 0.9659337, 0.8243477, 0.9534901, 0.9895803,…</span></span>
<span><span class="co">#&gt; $ psel_normalized <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9307375, 0.8944490, 0.4557587, 0.8558936, 0.9678483,…</span></span>
<span><span class="co">#&gt; $ geometry        <span style="color: #949494; font-style: italic;">&lt;POINT [m]&gt;</span> POINT (152 52.23333), POINT (172 58.1), POINT (1…</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="slice_sample">slice_sample<a class="anchor" aria-label="anchor" href="#slice_sample"></a>
</h4>
<p>If you don’t want to sample using <code>grts()</code> you can just
use <code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">dplyr::slice_sample()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">2024</span>,<span class="op">{</span></span>
<span><span class="va">random_sample</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">full_selection_probs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span> n <span class="op">=</span> <span class="fl">4</span>,by <span class="op">=</span> <span class="va">site_id</span>,</span>
<span>                       weight_by <span class="op">=</span> <span class="va">psel_normalized</span>,</span>
<span>                      replace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span> <span class="op">)</span> </span></code></pre></div>
<details><summary>
If you want to set site specific sample sizes, you can use some dplyr
tricks to handle that:
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">2024</span>,<span class="op">{</span></span>
<span><span class="va">random_sample_stratified</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">full_selection_probs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sample_size</span>,by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">site_id</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nest_by.html" class="external-link">nest_by</a></span><span class="op">(</span><span class="va">site_id</span>, <span class="va">N</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>.data <span class="op">=</span><span class="va">data</span>,</span>
<span>                                      n <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">N</span>,</span>
<span>                                      weight_by <span class="op">=</span> <span class="va">psel_normalized</span>,</span>
<span>                      replace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">site_id</span>, <span class="va">sample</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span> <span class="op">)</span> </span></code></pre></div>
</details><p>Oversamples with random sampling, just involves dropping recordings
you’ve selected and drawing some more.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oversample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">full_selection_probs</span>, </span>
<span>                     <span class="op">!</span><span class="va">path</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">random_sample</span><span class="op">$</span><span class="va">path</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span> n <span class="op">=</span> <span class="fl">2</span>,by <span class="op">=</span> <span class="va">site_id</span>,</span>
<span>                       weight_by <span class="op">=</span> <span class="va">psel_normalized</span>,</span>
<span>                      replace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
</div>
<div class="section level4">
<h4 id="compare-methods">Compare methods<a class="anchor" aria-label="anchor" href="#compare-methods"></a>
</h4>
<p>Looking at the draws, you may notice the <code>grts</code> results
are more spaced out, while the random sample, contains more clumping,
which is characteristic of random sampling.</p>
<p><img src="SubSample_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p><img src="SubSample_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="assigning-recording-lengths">Assigning recording lengths<a class="anchor" aria-label="anchor" href="#assigning-recording-lengths"></a>
</h3>
<p>While some surveys may include all full recordings, others may only
interpret a portion of some recordings, allowing for more recordings to
be at least partially interpreted.</p>
<p>To assign lengths, we can repeat the same process as above
sequentially assigning lengths or more simply just assign them all at
once.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">6546</span>,<span class="op">{</span></span>
<span><span class="va">random_sample</span><span class="op">$</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5min"</span>, <span class="st">"3min"</span>, <span class="st">"1min"</span><span class="op">)</span>,</span>
<span>                               size <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">random_sample</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">#&gt;   length P02_1 P03_1 P04_1 P05_1 P07_1 P08_1 P09_1 P10_1 P01_1 P06_1</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1min       1     3     1     1     3     2     1     1     0     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 3min       1     1     1     2     0     1     3     2     3     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 5min       2     0     2     1     1     1     0     1     1     1</span></span></code></pre>
<p>This however creates the issue that some sites will have less and
some more of each length.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">with_seed</a></span><span class="op">(</span><span class="fl">569</span>,<span class="op">{</span></span>
<span>  </span>
<span><span class="va">sample5min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span><span class="va">random_sample</span>,</span>
<span>                           n<span class="op">=</span><span class="fl">1</span>, by <span class="op">=</span> <span class="va">site_id</span>, weight_by <span class="op">=</span> <span class="va">psel_normalized</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sample3min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span><span class="va">random_sample</span> <span class="op">|&gt;</span> </span>
<span>                             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">path</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample5min</span><span class="op">$</span><span class="va">path</span><span class="op">)</span>,</span>
<span>                           n<span class="op">=</span><span class="fl">1</span>, by <span class="op">=</span> <span class="va">site_id</span>, weight_by <span class="op">=</span> <span class="va">psel_normalized</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">random_sample_with_lengths</span> <span class="op">&lt;-</span> <span class="va">random_sample</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Length_group <span class="op">=</span></span>
<span>           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">path</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample5min</span><span class="op">$</span><span class="va">path</span> <span class="op">~</span> <span class="st">"5min"</span>,</span>
<span>                     <span class="va">path</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample3min</span><span class="op">$</span><span class="va">path</span> <span class="op">~</span> <span class="st">"3min"</span>,</span>
<span>                     <span class="cn">TRUE</span><span class="op">~</span><span class="st">"1min"</span></span>
<span>           <span class="op">)</span>,</span>
<span>         length_clip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">Length_group</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Sampling by site and length creates an equal sample by length and
site.</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 11</span></span></span>
<span><span class="co">#&gt;   Length_group P01_1 P02_1 P03_1 P04_1 P05_1 P06_1 P07_1 P08_1 P09_1 P10_1</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1min             2     2     2     2     2     2     2     2     2     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 3min             1     1     1     1     1     1     1     1     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 5min             1     1     1     1     1     1     1     1     1     1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="assign-start-times">Assign start times<a class="anchor" aria-label="anchor" href="#assign-start-times"></a>
</h2>
<p>ARUtools includes the function <code>get_wav_length</code>, which
will return the length of a ‘wav’ file in seconds.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_sample_with_lengths</span><span class="op">$</span><span class="va">length_clip</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">map</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">random_sample_with_lengths</span><span class="op">)</span>,</span>
<span>      <span class="op">~</span><span class="fu"><a href="../reference/get_wav_length.html">get_wav_length</a></span><span class="op">(</span></span>
<span>        file <span class="op">=</span> <span class="va">random_sample_with_lengths</span><span class="op">$</span><span class="va">path</span><span class="op">[[</span><span class="va">.x</span><span class="op">]</span><span class="op">]</span>, </span>
<span>        return_numeric <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This can be used to safely add a random start time to your recordings
if you don’t want to all start at zero.</p>
<p>For this document we will assume all recordings are 5 minutes.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_sample_with_lengths</span><span class="op">$</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fl">5</span><span class="op">*</span><span class="fl">60</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_sample_with_lengths</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">random_sample_with_lengths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>StartTime <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">Length_group</span> <span class="op">==</span> <span class="st">"5min"</span><span class="op">~</span><span class="fl">0</span>,</span>
<span>                                 <span class="cn">TRUE</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>,</span>
<span>                                          <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>,</span>
<span>                                               <span class="va">length</span> <span class="op">-</span> <span class="va">length_clip</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="SubSample_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="section level3">
<h3 id="format-output-filename">Format output filename<a class="anchor" aria-label="anchor" href="#format-output-filename"></a>
</h3>
<p>Finally we can format the filenames for <a href="https://portal.wildtrax.ca/" class="external-link">Wildtrax</a>, which processes sites,
dates, and times based on file name.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_selection</span> <span class="op">&lt;-</span> <span class="va">random_sample_with_lengths</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_wildtrax.html">add_wildtrax</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">final_selection</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">wildtrax_file_name</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   path                                         wildtrax_file_name   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                        <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> P01/P01_1/BARLT10962_2028-07-06T07:00:00.wav P01_1_20280706_070000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> P01/P01_1/BARLT10962_2028-06-02T07:00:00.wav P01_1_20280602_070000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> P01/P01_1/BARLT10962_2028-05-15T06:30:00.wav P01_1_20280515_063000</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> P01/P01_1/BARLT10962_2028-07-04T06:30:00.wav P01_1_20280704_063000</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clip-and-copy-files-for-upload">Clip and copy files for upload<a class="anchor" aria-label="anchor" href="#clip-and-copy-files-for-upload"></a>
</h3>
<p>The <code>format_clip_wave</code> will rename, clip and copy your
file to a location that can then be used for uploading to <a href="https://portal.wildtrax.ca/" class="external-link">Wildtrax</a></p>
<p>Setting up a subset of folders will allow you to copy files to an
organized folder structure which can help with checking for errors prior
to uploading.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_directory</span> <span class="op">&lt;-</span> <span class="st">"/path/to/upload/directory/"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_directory</span>, recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">ul_tab</span> <span class="op">&lt;-</span> <span class="fu">expand_grid</span><span class="op">(</span>period <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Dawn'</span><span class="op">)</span>, <span class="co"># Add 'Dusk' if using more than one time period</span></span>
<span>                      length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">selected_recordings</span><span class="op">$</span><span class="va">Length_group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{out_directory}/{ul_tab$period}/{ul_tab$length}"</span><span class="op">)</span>, </span>
<span>           <span class="va">dir.create</span>,recursive <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>If you have a large number of files, you may want to run this
separately for files that require clipping and those that do not as it
will run much quicker for the files that do not need to be clipped.</p>
<p>You can use the option <code>use_job=T</code> to allow the use of the
<code>job</code> package, which will launch a background job if the
copying will take a long time.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_output</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/format_clip_wave.html">format_clip_wave</a></span><span class="op">(</span></span>
<span>    segment_df <span class="op">=</span> <span class="va">final_selection</span>,</span>
<span>    in_base_directory <span class="op">=</span> <span class="st">""</span>,out_base_directory <span class="op">=</span>  <span class="va">out_directory</span>, </span>
<span>    length_clip_col <span class="op">=</span> <span class="st">"length_clip"</span>, </span>
<span>    sub_dir_out_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time_period"</span>, <span class="st">"Length_group"</span><span class="op">)</span>, </span>
<span>    filepath_in_col <span class="op">=</span> <span class="st">"path"</span>,</span>
<span>    out_filename_col <span class="op">=</span><span class="st">"wildtrax_file_name"</span>,  </span>
<span>    use_job <span class="op">=</span> <span class="cn">F</span>, filewarn <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>That’s it, your output folder should now have your selected files,
properly named for <a href="https://portal.wildtrax.ca/" class="external-link">Wildtrax</a>
and ready to upload.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Hope, Steffi LaZerte.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
